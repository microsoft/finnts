<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Prep Data — prep_data • finnts</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Prep Data — prep_data"><meta property="og:description" content="Preps data with various feature engineering recipes to create features before training models"><meta property="og:image" content="https://microsoft.github.io/finnts/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-6X0DS5856B"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-6X0DS5856B');
</script></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">finnts</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.6.0.9001</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/finnts.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/ai-agent.html">AI Agent Capabilities</a>
    </li>
    <li>
      <a href="../articles/back-testing-and-hyperparameter-tuning.html">Back Testing and Hyperparameter Tuning</a>
    </li>
    <li>
      <a href="../articles/best-model-selection.html">Best Model Selection</a>
    </li>
    <li>
      <a href="../articles/external-regressors.html">External Regressors</a>
    </li>
    <li>
      <a href="../articles/feature-engineering.html">Feature Engineering</a>
    </li>
    <li>
      <a href="../articles/feature-selection.html">Feature Selection</a>
    </li>
    <li>
      <a href="../articles/forecast-components.html">Using Individual finnts Forecast Components</a>
    </li>
    <li>
      <a href="../articles/hierarchical-forecasting.html">Hierarchical Forecasting</a>
    </li>
    <li>
      <a href="../articles/models-used-in-finnts.html">Models Used in finnts</a>
    </li>
    <li>
      <a href="../articles/parallel-processing.html">Parallel Processing</a>
    </li>
    <li>
      <a href="../articles/tips-for-production.html">Tips for Production</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/microsoft/finnts/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Prep Data</h1>
    <small class="dont-index">Source: <a href="https://github.com/microsoft/finnts/blob/main/R/prep_data.R" class="external-link"><code>R/prep_data.R</code></a></small>
    <div class="hidden name"><code>prep_data.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Preps data with various feature engineering recipes to create features before training models</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">prep_data</span><span class="op">(</span></span>
<span>  <span class="va">run_info</span>,</span>
<span>  <span class="va">input_data</span>,</span>
<span>  <span class="va">combo_variables</span>,</span>
<span>  <span class="va">target_variable</span>,</span>
<span>  <span class="va">date_type</span>,</span>
<span>  <span class="va">forecast_horizon</span>,</span>
<span>  external_regressors <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  hist_start_date <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  hist_end_date <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  combo_cleanup_date <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  fiscal_year_start <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  clean_missing_values <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  clean_outliers <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  box_cox <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  stationary <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  forecast_approach <span class="op">=</span> <span class="st">"bottoms_up"</span>,</span>
<span>  parallel_processing <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  num_cores <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  fourier_periods <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  lag_periods <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  rolling_window_periods <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  recipes_to_run <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  multistep_horizon <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-run-info">run_info<a class="anchor" aria-label="anchor" href="#arg-run-info"></a></dt>
<dd><p>Run info using <code><a href="set_run_info.html">set_run_info()</a></code></p></dd>


<dt id="arg-input-data">input_data<a class="anchor" aria-label="anchor" href="#arg-input-data"></a></dt>
<dd><p>A standard data frame, tibble, or spark data frame using sparklyr of historical time series data.
Can also include external regressors for both historical and future data.</p></dd>


<dt id="arg-combo-variables">combo_variables<a class="anchor" aria-label="anchor" href="#arg-combo-variables"></a></dt>
<dd><p>List of column headers within input data to be used to separate individual time series.</p></dd>


<dt id="arg-target-variable">target_variable<a class="anchor" aria-label="anchor" href="#arg-target-variable"></a></dt>
<dd><p>The column header formatted as a character value within input data you want to forecast.</p></dd>


<dt id="arg-date-type">date_type<a class="anchor" aria-label="anchor" href="#arg-date-type"></a></dt>
<dd><p>The date granularity of the input data. Finn accepts the following as a character string:
day, week, month, quarter, year.</p></dd>


<dt id="arg-forecast-horizon">forecast_horizon<a class="anchor" aria-label="anchor" href="#arg-forecast-horizon"></a></dt>
<dd><p>Number of periods to forecast into the future.</p></dd>


<dt id="arg-external-regressors">external_regressors<a class="anchor" aria-label="anchor" href="#arg-external-regressors"></a></dt>
<dd><p>List of column headers within input data to be used as features in multivariate models.</p></dd>


<dt id="arg-hist-start-date">hist_start_date<a class="anchor" aria-label="anchor" href="#arg-hist-start-date"></a></dt>
<dd><p>Date value of when your input_data starts. Default of NULL uses earliest date value in
input_data.</p></dd>


<dt id="arg-hist-end-date">hist_end_date<a class="anchor" aria-label="anchor" href="#arg-hist-end-date"></a></dt>
<dd><p>Date value of when your input_data ends. Default of NULL uses the latest date value in
input_data.</p></dd>


<dt id="arg-combo-cleanup-date">combo_cleanup_date<a class="anchor" aria-label="anchor" href="#arg-combo-cleanup-date"></a></dt>
<dd><p>Date value to remove individual time series that don't contain non-zero values after
that specified date. Default of NULL is to not remove any time series and attempt to forecast all time series.</p></dd>


<dt id="arg-fiscal-year-start">fiscal_year_start<a class="anchor" aria-label="anchor" href="#arg-fiscal-year-start"></a></dt>
<dd><p>Month number of start of fiscal year of input data, aids in building out date features.
Formatted as a numeric value. Default of 1 assumes fiscal year starts in January.</p></dd>


<dt id="arg-clean-missing-values">clean_missing_values<a class="anchor" aria-label="anchor" href="#arg-clean-missing-values"></a></dt>
<dd><p>If TRUE, cleans missing values. Only impute values for missing data within an
existing series, and does not add new values onto the beginning or end, but does provide a value of 0 for said
values.</p></dd>


<dt id="arg-clean-outliers">clean_outliers<a class="anchor" aria-label="anchor" href="#arg-clean-outliers"></a></dt>
<dd><p>If TRUE, outliers are cleaned and inputted with values more in line with historical data.</p></dd>


<dt id="arg-box-cox">box_cox<a class="anchor" aria-label="anchor" href="#arg-box-cox"></a></dt>
<dd><p>Apply box-cox transformation to normalize variance in data</p></dd>


<dt id="arg-stationary">stationary<a class="anchor" aria-label="anchor" href="#arg-stationary"></a></dt>
<dd><p>Apply differencing to make data stationary</p></dd>


<dt id="arg-forecast-approach">forecast_approach<a class="anchor" aria-label="anchor" href="#arg-forecast-approach"></a></dt>
<dd><p>How the forecast is created. The default of 'bottoms_up' trains models for each individual
time series. Value of 'grouped_hierarchy' creates a grouped time series to forecast at while 'standard_hierarchy' creates
a more traditional hierarchical time series to forecast, both based on the hts package.</p></dd>


<dt id="arg-parallel-processing">parallel_processing<a class="anchor" aria-label="anchor" href="#arg-parallel-processing"></a></dt>
<dd><p>Default of NULL runs no parallel processing and forecasts each individual time series
one after another. Value of 'local_machine' leverages all cores on current machine Finn is running on.
Value of 'spark' runs time series in parallel on a spark cluster in Azure Databricks/Synapse.</p></dd>


<dt id="arg-num-cores">num_cores<a class="anchor" aria-label="anchor" href="#arg-num-cores"></a></dt>
<dd><p>Number of cores to run when parallel processing is set up. Used when running parallel computations
on local machine or within Azure. Default of NULL uses total amount of cores on machine minus one. Can't be greater
than number of cores on machine minus 1.</p></dd>


<dt id="arg-fourier-periods">fourier_periods<a class="anchor" aria-label="anchor" href="#arg-fourier-periods"></a></dt>
<dd><p>List of values to use in creating fourier series as features. Default of NULL automatically chooses
these values based on the date_type.</p></dd>


<dt id="arg-lag-periods">lag_periods<a class="anchor" aria-label="anchor" href="#arg-lag-periods"></a></dt>
<dd><p>List of values to use in creating lag features. Default of NULL automatically chooses these values
based on date_type.</p></dd>


<dt id="arg-rolling-window-periods">rolling_window_periods<a class="anchor" aria-label="anchor" href="#arg-rolling-window-periods"></a></dt>
<dd><p>List of values to use in creating rolling window features. Default of NULL automatically
chooses these values based on date_type.</p></dd>


<dt id="arg-recipes-to-run">recipes_to_run<a class="anchor" aria-label="anchor" href="#arg-recipes-to-run"></a></dt>
<dd><p>List of recipes to run on multivariate models that can run different recipes. A value of NULL runs
all recipes, but only runs the R1 recipe for weekly and daily date types. A value of "all" runs all recipes, regardless
of date type. A list like c("R1") or c("R2") would only run models with the R1 or R2 recipe.</p></dd>


<dt id="arg-multistep-horizon">multistep_horizon<a class="anchor" aria-label="anchor" href="#arg-multistep-horizon"></a></dt>
<dd><p>Use a multistep horizon approach when training multivariate models with R1 recipe.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>No return object. Feature engineered data is written to disk based on the output locations provided in
<code><a href="set_run_info.html">set_run_info()</a></code>.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="va">data_tbl</span> <span class="op">&lt;-</span> <span class="fu">timetk</span><span class="fu">::</span><span class="va"><a href="https://business-science.github.io/timetk/reference/m4_monthly.html" class="external-link">m4_monthly</a></span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="va">date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">Date</span> <span class="op">&gt;=</span> <span class="st">"2013-01-01"</span>,</span></span>
<span class="r-in"><span>    <span class="va">Date</span> <span class="op">&lt;=</span> <span class="st">"2015-06-01"</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">run_info</span> <span class="op">&lt;-</span> <span class="fu"><a href="set_run_info.html">set_run_info</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Finn Submission Info</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">•</span> Project Name: finn_project</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">•</span> Run Name: finn_fcst-20250911T202919Z</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">prep_data</span><span class="op">(</span><span class="va">run_info</span>,</span></span>
<span class="r-in"><span>  input_data <span class="op">=</span> <span class="va">data_tbl</span>,</span></span>
<span class="r-in"><span>  combo_variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  target_variable <span class="op">=</span> <span class="st">"value"</span>,</span></span>
<span class="r-in"><span>  date_type <span class="op">=</span> <span class="st">"month"</span>,</span></span>
<span class="r-in"><span>  forecast_horizon <span class="op">=</span> <span class="fl">3</span>,</span></span>
<span class="r-in"><span>  recipes_to_run <span class="op">=</span> <span class="st">"R1"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Prepping Data</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> Prepping Data <span style="color: #B2B2B2;">[1.2s]</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by <a href="https://www.linkedin.com/in/michaeltokic/" class="external-link">Mike Tokic</a>, <a href="https://aadharshkannan.com/" class="external-link">Aadharsh Kannan</a>.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer></div>






  </body></html>

